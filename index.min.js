!function(){"use strict";const _=Object.freeze({__JSONG_DATE__:"__JSONG_DATE__",__JSONG_KEYCHAIN__:"__JSONG_KEYCHAIN__",__JSONG_REFERENCE_ID__:"__JSONG_REFERENCE_ID__",__JSONG_SERIALIZED__:"__JSONG_SERIALIZED__",__JSONG_PRIMITIVE__:"__JSONG_PRIMITIVE__",__JSONG_ARRAY__:"__JSONG_ARRAY__"});function e(_){return _ instanceof Date}function t(_){return"object"==typeof _&&null!==_}function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,_=>{const e=16*Math.random()|0;return("x"===_?e:3&e|8).toString(16)})}function r(_,e){if(!t(_)||!Array.isArray(e)||!e.length)return;let n=_;for(let _=0;_<e.length;++_)n=n[e[_]];return n}function E(_,e,n){if(!t(_)||!Array.isArray(e)||!e.length)return;let r=_;for(let _=0;_<e.length-1;++_)r=r[e[_]];r[e[e.length-1]]=n}function N(e){return t(e)?Object.keys(e).filter(e=>!_[e]).map(_=>e[_]):[]}function i(_,e){const t=e[_.__JSONG_REFERENCE_ID__];if(!t){const t=void 0!==_.__JSONG_ARRAY__?[]:{};return e[_.__JSONG_REFERENCE_ID__]=t,t}return t}function S(e,n){return t(e)?Object.keys(e).filter(e=>!_[e]).map(_=>[...n,_]):[]}globalThis.JSONG=Object.freeze({serialize:function(_){if(e(_))return JSON.stringify({__JSONG_DATE__:_.getTime(),__JSONG_SERIALIZED__:!0});if(!t(_))return JSON.stringify(_);const N=n(),i={__JSONG_SERIALIZED__:!0,__JSONG_REFERENCE_ID__:N,__JSONG_KEYCHAIN__:[]};Array.isArray(_)&&(i.__JSONG_ARRAY__=[]);const O=i.__JSONG_ARRAY__||i,J=new WeakMap;J.set(_,N);const A=S(_,[]);for(;A.length;){const[N]=A.splice(0,1),i=r(_,N),R={__JSONG_KEYCHAIN__:N};if(e(i))R.__JSONG_DATE__=i.getTime();else if(t(i)){if(t(i)){const _=J.get(i);if(Array.isArray(i)&&(R.__JSONG_ARRAY__=[]),_)R.__JSONG_REFERENCE_ID__=_;else{const _=S(i,N);J.set(i,n());for(let e=0;e<_.length;++e)A.push(_[e])}}}else R.__JSONG_PRIMITIVE__=i;E(O,N,R)}return JSON.stringify(i)},deserialize:function(_){const e=globalThis.JSON.parse(_);if(!t(e)||!e.__JSONG_SERIALIZED__)return e;if(void 0!==e.__JSONG_DATE__)return new Date(e.__JSONG_DATE__);const n=e.__JSONG_ARRAY__?[]:{},r={[e.__JSONG_REFERENCE_ID__]:n},S=N(e.__JSONG_ARRAY__||e);for(;S.length;){const[_]=S.splice(0,1);if(void 0!==_.__JSONG_DATE__)E(n,_.__JSONG_KEYCHAIN__,new Date(_.__JSONG_DATE__));else if(void 0!==_.__JSONG_PRIMITIVE__)E(n,_.__JSONG_KEYCHAIN__,_.__JSONG_PRIMITIVE__);else if(void 0!==_.__JSONG_REFERENCE_ID__){const e=i(_,r),t=N(e),O=N(_.__JSONG_ARRAY__||_);if(t.length<O.length)for(let _=0;_<O.length;++_)S.push(O[_]);E(n,_.__JSONG_KEYCHAIN__,e)}}return n}})}();